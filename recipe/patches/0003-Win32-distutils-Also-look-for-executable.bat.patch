From 705382fb16fda08ac00e7fc2a4b6b46da18ee2cf Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Wed, 16 Aug 2017 11:07:08 +0100
Subject: [PATCH 03/20] Win32: distutils: Also look for executable.bat

This patch should probably not exist, or at least be
rewritten. See the comments.
---
 Lib/distutils/spawn.py | 31 +++++++++++++++++++++++--------
 1 file changed, 23 insertions(+), 8 deletions(-)

diff --git a/Lib/distutils/spawn.py b/Lib/distutils/spawn.py
index 5387688..ae9cb8e 100644
--- a/Lib/distutils/spawn.py
+++ b/Lib/distutils/spawn.py
@@ -173,11 +173,24 @@ def find_executable(executable, path=None):
     os.environ['PATH'].  Returns the complete filename or None if not found.
     """
     _, ext = os.path.splitext(executable)
-    if (sys.platform == 'win32') and (ext != '.exe'):
-        executable = executable + '.exe'
+    if (sys.platform == 'win32'):
+	# This should probably be:
+        # try:
+        #     exts = os.environ['PATHEXT'].lower().split(';')+['']
+        # except:
+        #     exts = ['.exe.', '.bat', '']
+        # but IMHO:
+        # 1. The original `ext` should appear as the first entry.
+        # 2. We should be adding `exts` to `base`, not `executable`
+        # 3. Why even bother? We do not add '.sh' for Unix.
+        exts = [ext, '.exe', '.bat', '']
+    else:
+        exts = ['']
 
-    if os.path.isfile(executable):
-        return executable
+    for ext in exts:
+        newexe = executable + ext
+        if os.path.isfile(newexe):
+            return newexe
 
     if path is None:
         path = os.environ.get('PATH', None)
@@ -196,8 +209,10 @@ def find_executable(executable, path=None):
 
     paths = path.split(os.pathsep)
     for p in paths:
-        f = os.path.join(p, executable)
-        if os.path.isfile(f):
-            # the file exists, we have a shot at spawn working
-            return f
+        for ext in exts:
+            newexe = executable + ext
+            f = os.path.join(p, newexe)
+            if os.path.isfile(f):
+                # the file exists, we have a shot at spawn working
+                return f
     return None
-- 
2.7.4

